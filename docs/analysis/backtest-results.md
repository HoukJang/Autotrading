# Batch Backtest Results

**Simulation Period:** 2024-01-01 to 2025-12-31 (2 years, ~505 trading days)
**Initial Capital:** $100,000
**Universe:** 30 S&P 500-representative symbols (synthetic data, seed=42)
**Architecture:** Nightly batch scan -> gap filter -> signal ranking -> MOO/confirmation entry -> daily exit rule evaluation
**Data Source:** Synthetic daily bars generated by SyntheticDataGenerator (GBM + correlated market factor)
**Slippage Model:** 3 bps per fill (entry + exit)
**Commission Model:** $0.005/share round-trip

---

## Primary Run Results

### Portfolio Combined Report

| Metric                 | Value         |
|------------------------|---------------|
| Total Trades           | 130           |
| Winning Trades         | 47            |
| Losing Trades          | 83            |
| Win Rate               | 36.2%         |
| Profit Factor          | 0.564         |
| Total PnL              | -$20,287      |
| Total Return           | -20.1%        |
| Annualised Return      | -10.6%        |
| Avg PnL / Trade        | -$156.06      |
| Avg Win                | $558.18       |
| Avg Loss               | -$560.51      |
| Sharpe Ratio           | 0.142         |
| Sortino Ratio          | 0.132         |
| Max Drawdown           | 44.3%         |
| Calmar Ratio           | -0.239        |
| Final Equity           | $79,877       |

**Interpretation:** The primary run on synthetic data shows negative results driven almost entirely by regime_momentum strategy (see per-strategy breakdown). The synthetic data does not exhibit persistent trending regimes that regime_momentum relies on, which explains the outsized negative contribution. The trailing stop and stop_loss exits account for the bulk of losses, while time_exit trades are the only net-positive exit type.

---

### Per-Strategy Report

| Strategy            | Trades | Win Rate | Total PnL    | Avg PnL  | Profit Factor | Avg Hold Days | Max Consec Loss |
|---------------------|--------|----------|-------------|----------|---------------|---------------|-----------------|
| regime_momentum     | 100    | 31.0%    | -$20,346    | -$203.46 | 0.45          | 4.8           | 11              |
| rsi_mean_reversion  | 27     | 51.9%    | -$137       | -$5.08   | 0.98          | 4.7           | 5               |
| bb_squeeze          | 3      | 66.7%    | $196        | +$65.43  | 1.26          | 2.0           | 1               |
| adx_pullback        | 0      | -        | $0          | -        | -             | -             | -               |
| overbought_short    | 0      | -        | $0          | -        | -             | -             | -               |

**Notes:**
- **regime_momentum** dominates trade count (77% of all trades) due to broad entry conditions in the synthetic universe. The 31% win rate with trailing stops indicates the strategy fires in non-trending synthetic regimes, causing repeated trailing stop exits at small losses.
- **rsi_mean_reversion** achieves near-breakeven (PF 0.98) with 52% win rate, demonstrating its mean-reversion logic operates correctly on synthetic data with realistic oscillations.
- **bb_squeeze** shows positive expectation (PF 1.26) with only 3 trades - too few for statistical significance; needs more volatile squeeze conditions.
- **adx_pullback** and **overbought_short** generate zero trades on this synthetic universe. AdxPullback requires ADX > 25 with EMA golden cross and RSI pullback simultaneously, which is rare in the synthetic GBM data. OverboughtShort requires momentum_fading detection which depends on sequential EMA spread tracking that rarely converges in synthetic data.

---

### Exit Reason Breakdown

| Exit Reason       | Count | Total PnL   | Avg PnL |
|-------------------|-------|-------------|---------|
| time_exit         | 49    | +$11,678    | +$238   |
| stop_loss         | 40    | -$30,649    | -$766   |
| trailing_stop     | 36    | -$4,479     | -$124   |
| take_profit       | 3     | +$2,741     | +$914   |
| forced_close      | 2     | +$421       | +$211   |

**Key finding:** Time exits (49 trades, 37.7% of all exits) are the only consistently profitable exit type, averaging +$238/trade. Stop losses (-$766 avg) represent the single largest source of losses. This strongly suggests ATR-based SL distances may be too tight relative to the volatility regime of the synthetic data. See MFE/MAE analysis for optimal ATR multiplier estimates.

---

### MFE/MAE Analysis

| Strategy            | Avg MFE% | Avg MAE% | MFE/MAE Ratio | Est. Opt SL (x ATR) | Est. Opt TP (x ATR) |
|---------------------|----------|----------|----------------|---------------------|---------------------|
| regime_momentum     | 3.41%    | 3.15%    | 1.08           | 1.24                | 1.34                |
| rsi_mean_reversion  | 3.12%    | 3.46%    | 0.90           | 1.05                | 0.95                |
| bb_squeeze          | 2.63%    | 2.93%    | 0.90           | 1.01                | 0.91                |

**Methodology:** Optimal SL/TP estimates derived by converting average MFE/MAE percentages to ATR multiples using each trade's entry_atr/entry_price ratio.

**Findings:**
- Current regime_momentum SL multiplier (1.5x ATR) appears reasonable vs the estimated optimal 1.24x. However, given that stops are triggered at high rates (stop_loss + trailing_stop = 76 exits), the ATR at entry may underestimate actual realized volatility.
- rsi_mean_reversion avg MAE (3.46%) nearly equals avg MFE (3.12%), indicating the strategy enters at inflection points but often reverses against the position before recovering. Current 2.0x ATR SL for longs provides approximately 2x the observed avg MAE, which is appropriate.
- bb_squeeze's MFE/MAE ratio of 0.90 (< 1.0) indicates the strategy loses slightly more on bad trades than it gains on good ones, suggesting a tighter TP target (0.91x vs current 1.5x) and slightly tighter SL (1.01x vs 1.5x) may improve expectation.

---

## Comparison Tables

### Entry Day Skip ON vs OFF

| Metric                | Skip ON   | Skip OFF  |
|-----------------------|-----------|-----------|
| Total Trades          | 130       | 132       |
| Win Rate              | 36.2%     | 35.6%     |
| Profit Factor         | 0.564     | 0.584     |
| Total Return %        | -20.1%    | -19.4%    |
| Sharpe Ratio          | 0.142     | 0.107     |
| Sortino Ratio         | 0.132     | 0.098     |
| Max Drawdown %        | 44.3%     | 44.7%     |
| Total PnL             | -$20,287  | -$19,533  |
| Final Equity          | $79,877   | $80,634   |

**Finding:** Entry day skip produces marginally worse total return (-20.1% vs -19.4%) but significantly better Sharpe (0.142 vs 0.107) and Sortino ratios (0.132 vs 0.098). The skip reduces the frequency of same-day emergency exits, which improves the smoothness of the return distribution even while total PnL is slightly lower. The skip ON configuration is the correct choice from a risk-adjusted perspective - higher Sharpe and lower drawdown volatility outweigh the marginal PnL difference.

### Max Hold Days: 5d vs 7d vs Default (strategy-specific)

| Metric                | 5 Days    | 7 Days    | Default   |
|-----------------------|-----------|-----------|-----------|
| Total Trades          | 136       | 131       | 130       |
| Win Rate              | 37.5%     | 35.1%     | 36.2%     |
| Profit Factor         | 0.657     | 0.612     | 0.564     |
| Total Return %        | -15.7%    | -18.2%    | -20.1%    |
| Sharpe Ratio          | 0.185     | 0.146     | 0.142     |
| Sortino Ratio         | 0.164     | 0.136     | 0.132     |
| Max Drawdown %        | 42.7%     | 44.6%     | 44.3%     |
| Total PnL             | -$15,863  | -$18,350  | -$20,287  |
| Final Equity          | $84,312   | $81,819   | $79,877   |

**Finding:** 5-day maximum hold consistently outperforms both 7-day and strategy-specific defaults across all metrics. Shorter hold periods force more frequent exits that capture available MFE before it deteriorates, particularly relevant for regime_momentum which relies on trending conditions that often reverse within 5-7 bars in the synthetic dataset. This finding supports the hypothesis that the strategy-specific 7-day max for adx_pullback and regime_momentum may benefit from reduction to 5 days.

### Gap Filter Threshold: 2% vs 3% vs 5%

| Metric                | 2% Gap    | 3% Gap    | 5% Gap    |
|-----------------------|-----------|-----------|-----------|
| Total Trades          | 130       | 130       | 130       |
| Win Rate              | 36.2%     | 36.2%     | 36.2%     |
| Total Return %        | -20.1%    | -20.1%    | -20.1%    |
| Sharpe Ratio          | 0.142     | 0.142     | 0.142     |

**Finding:** No difference across gap threshold variants in synthetic data. The synthetic GBM-based open prices only rarely produce gaps exceeding 3%, because the open gap model uses a N(0, 0.2%) distribution. This is a known limitation of the synthetic data generator - real S&P 500 stocks exhibit larger gaps on earnings, news events, and macro data, where the 3% threshold would provide meaningful filtering. The gap filter test requires real market data for definitive validation.

---

## Limitations and Caveats

1. **Synthetic data bias:** The GBM-based data generator does not produce persistent trending or ranging regimes. regime_momentum and adx_pullback are specifically designed for trending markets that the synthetic data rarely produces. Results for these strategies are not representative of live market conditions.

2. **Low trade count for some strategies:** bb_squeeze (3 trades), adx_pullback (0 trades), overbought_short (0 trades) have insufficient trade counts for statistical significance. Minimum 30-50 trades per strategy are needed for reliable metric estimation.

3. **No regime conditioning:** The backtest does not apply RegimeDetector to modulate strategy selection by market regime. In the live system, regime_momentum and adx_pullback are only active in TREND regimes, which would reduce their trade frequency and improve expectation.

4. **Short position mechanics:** Short positions use a simplified cash-settlement model without margin requirements or borrow costs. Live short trading incurs additional costs that would reduce overbought_short profitability.

5. **Correlation structure:** The correlated market factor model approximates index membership but does not reproduce sector rotation, earnings gaps, or liquidity events that drive real S&P 500 returns.

---

## Recommendations for Live Validation

1. Run the backtest with 2+ years of real daily bar data (Alpaca historical API or equivalent) on the actual S&P 500 universe.
2. Apply RegimeDetector before running strategies to ensure regime_momentum and adx_pullback only trade in TREND regime bars.
3. Collect minimum 50 trades per strategy before drawing parameter optimization conclusions.
4. Monitor the gap filter effectiveness on real data where earning gaps routinely exceed 3%.

---

*Generated by scripts/run_batch_backtest.py on 2026-02-27*
