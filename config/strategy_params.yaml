# Strategy-specific execution parameters for batch+intraday hybrid architecture.
# These values control entry groups, SL/TP multipliers, and time-based exit windows.

entry_groups:
  # Group A: Market-on-Open orders submitted at 9:30 AM ET
  moo:
    strategies:
      - rsi_mean_reversion
      - consecutive_down
      - ema_cross_trend
    order_type: market

  # Group B: Confirmation window, 9:45-10:00 AM ET
  confirmation:
    strategies: []
    order_type: market
    # Long confirm: price >= prev_close * (1 - gap_tol)
    # Short confirm: price <= prev_close * (1 + gap_tol)
    gap_tolerance: 0.003
    window_open_hour: 9
    window_open_minute: 45
    window_close_hour: 10
    window_close_minute: 0

# Gap filter: skip signals where overnight gap exceeds threshold
gap_filter:
  max_gap_pct: 0.03   # 3% max gap (tightened from 5%)

# Per-trade loss hard cap (overrides SL if unrealized loss exceeds this)
max_loss_per_trade:
  max_loss_pct: 0.03   # 3% of entry price

# Daily entry limits
entry_limits:
  max_daily_entries: 3    # portfolio-level total cap per day (per-strategy GDR may restrict further)
  max_long_positions: 4   # hard cap on concurrent longs
  max_short_positions: 3  # hard cap on concurrent shorts
  max_total_positions: 5  # overall position cap

# Per-Strategy Graduated Drawdown Response (GDR)
# Each strategy tracks its own cumulative PnL drawdown independently.
# When drawdown exceeds thresholds, risk sizing and entry limits are reduced per strategy.
per_strategy_gdr:
  enabled: true            # toggle per-strategy GDR (false = legacy portfolio-level GDR)

  # Per-strategy base risk (fraction of equity risked per trade)
  base_risk:
    rsi_mean_reversion: 0.01   # 1% (reduced from 2% due to higher loss rate)
    consecutive_down: 0.02     # 2%
    ema_cross_trend: 0.015     # 1.5%
    default: 0.02              # fallback for unknown strategies

  # Per-strategy drawdown thresholds: [tier1_dd, tier2_dd]
  # DD is calculated as (peak_cum_pnl - current_cum_pnl) / initial_capital
  thresholds:
    rsi_mean_reversion: [0.025, 0.05]   # Tier 1 at 2.5%, Tier 2 (HALT) at 5%
    consecutive_down: [0.03, 0.06]      # Tier 1 at 3%, Tier 2 (HALT) at 6%
    ema_cross_trend: [0.04, 0.08]       # Tier 1 at 4%, Tier 2 (HALT) at 8%

  # Risk multipliers per GDR tier
  risk_multipliers:
    tier_0: 1.0   # normal
    tier_1: 0.5   # reduced
    tier_2: 0.0   # HALTED (no entries)

  # Per-strategy max entries per day per tier
  strategy_entries:
    tier_0: 1   # 1 entry per strategy per day
    tier_1: 1   # 1 entry per strategy per day
    tier_2: 0   # 0 entries (halted)

  # Portfolio safety net (overrides per-strategy GDR when total DD is extreme)
  safety_net:
    activation_dd: 0.20      # activate when total portfolio DD > 20%
    recovery_dd: 0.15        # deactivate when DD recovers below 15%
    max_entries: 1            # 1 entry total when active
    risk_pct: 0.005           # 0.5% risk when active

# Per-strategy SL/TP configuration
strategies:
  rsi_mean_reversion:
    adx_max: 23.0              # relaxed to 23.0 for more trades while still filtering trending markets
    sl_atr_mult_long: 1.0
    sl_atr_mult_short: 1.5
    tp_rsi_long: 50.0       # exit long when RSI > 50
    tp_rsi_short: 50.0      # exit short when RSI < 50
    tp_bb_pct_b_long: 0.50  # exit long when pct_b > 0.50
    tp_bb_pct_b_short: 0.50 # exit short when pct_b < 0.50
    tp_atr_mult: 2.0        # auxiliary ATR TP cap
    max_hold_days: 5
    trailing_stop: false
    breakeven_activation_atr: 0.6  # move SL to entry after 0.6 ATR profit

  consecutive_down:
    sl_atr_mult_long: 1.0
    tp_ema_short: 5              # exit when close > EMA(5)
    max_hold_days: 5
    trailing_stop: false
    breakeven_activation_atr: 0.6

  ema_pullback:
    enabled: false
    sl_atr_mult_long: 1.0
    tp_atr_mult: 2.0
    max_hold_days: 7
    trailing_stop: false
    trailing_atr_mult: 2.0
    trailing_activation_atr: 1.0
    breakeven_activation_atr: 0.6

  ema_cross_trend:
    enabled: false                  # disabled after 16th backtest RED LINE fail
    ema_fast: 10
    ema_slow: 21
    adx_min: 28.0
    adx_rise_threshold: 2.0
    min_momentum_bars: 2
    rsi_long_min: 40.0
    rsi_long_max: 70.0
    rsi_short_min: 30.0
    rsi_short_max: 60.0
    sl_atr_mult_long: 3.0
    sl_atr_mult_short: 3.0
    tp_atr_mult: 5.0
    max_hold_days: 10
    trailing_stop: true
    trailing_atr_mult: 2.0
    trailing_activation_atr: 1.5
    breakeven_activation_atr: 0.6

  # volume_divergence: REMOVED (13th backtest P0 decision)

# Emergency exits (override all other rules, Day 1 only)
emergency_exit:
  pct_loss_confirm: 0.07    # -7% over 2 consecutive bars triggers exit
  pct_loss_immediate: 0.10  # -10% single-bar triggers immediate exit
  bars_for_confirm: 2

# Re-entry block: same symbol blocked for rest of trading day after close
reentry_block:
  block_all_strategies: true  # block symbol regardless of which strategy closed it
  reset_on_new_day: true      # clear block list at market open each day
